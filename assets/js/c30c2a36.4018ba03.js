"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[422],{9573:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>r});var s=n(5893),l=n(1151);const t={sidebar_position:5},i="How to add a proposal module",a={id:"dao-governance/proposals/how-to-add-a-proposal-module",title:"How to add a proposal module",description:"The proposal module system enables DAOs to support any type of execution flow",source:"@site/docs/dao-governance/proposals/how-to-add-a-proposal-module.md",sourceDirName:"dao-governance/proposals",slug:"/dao-governance/proposals/how-to-add-a-proposal-module",permalink:"/dao-governance/proposals/how-to-add-a-proposal-module",draft:!1,unlisted:!1,editUrl:"https://github.com/DA0-DA0/docs/tree/main/docs/dao-governance/proposals/how-to-add-a-proposal-module.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"How to vote on a proposal",permalink:"/dao-governance/proposals/how-to-vote-on-a-proposal"},next:{title:"Manage Vetoable DAOs",permalink:"/dao-governance/manage-vetoable-daos"}},d={},r=[{value:"Guide",id:"guide",level:2}];function c(e){const o={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.h1,{id:"how-to-add-a-proposal-module",children:"How to add a proposal module"}),"\n",(0,s.jsx)(o.p,{children:"The proposal module system enables DAOs to support any type of execution flow\nthat can be coded in a smart contract."}),"\n",(0,s.jsx)(o.p,{children:"DAO DAO provides two modules:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"single choice (e.g. Yes/No/Abstain)"}),"\n",(0,s.jsx)(o.li,{children:"multiple choice (e.g. A/B/C/None of the Above)"}),"\n"]}),"\n",(0,s.jsx)(o.p,{children:"You can always add new modules or disable existing ones, though there must\nalways be at least one module enabled (or else the DAO will not function). The\nmost likely reason one would want to add a new module is to use a new version\nwith new features. Because the proposal module interface is standardized and\nunchanging, newer versions of proposal modules should be backwards compatible."}),"\n",(0,s.jsx)(o.p,{children:"Adding and disabling proposal modules is not common, and can be dangerous, and\nthus is not easily supported by the UI, but it is not hard to do with a little\nbit of time."}),"\n",(0,s.jsxs)(o.blockquote,{children:["\n",(0,s.jsx)(o.p,{children:"\u26a0\ufe0f Be careful to verify all proposal modules function correctly before\ndisabling one you no longer need, because if the only enabled proposal modules\nare broken or the addresses are incorrect, the DAO will be bricked and all\nassets will be locked."}),"\n"]}),"\n",(0,s.jsx)(o.h2,{id:"guide",children:"Guide"}),"\n",(0,s.jsxs)(o.p,{children:["First you need the code IDs of the proposal module and its corresponding\npre-propose module. You can find all uploaded DAO DAO code IDs here:\n",(0,s.jsx)(o.a,{href:"https://github.com/DA0-DA0/dao-dao-ui/blob/development/packages/utils/constants/codeIds.json",children:"https://github.com/DA0-DA0/dao-dao-ui/blob/development/packages/utils/constants/codeIds.json"})]}),"\n",(0,s.jsxs)(o.p,{children:["The following guide will add the ",(0,s.jsx)(o.code,{children:"v2.6.0"})," single choice proposal module to a DAO\non Osmosis mainnet (",(0,s.jsx)(o.code,{children:"osmosis-1"}),"), so we need the ",(0,s.jsx)(o.code,{children:"dao-proposal-single"})," and\n",(0,s.jsx)(o.code,{children:"dao-pre-propose-single"})," code IDs."]}),"\n",(0,s.jsxs)(o.p,{children:["A few steps involve base64 encoding, which\n",(0,s.jsx)(o.a,{href:"https://www.base64encode.org/",children:"base64encode.org"})," can help with."]}),"\n",(0,s.jsx)(o.p,{children:"Here is the configuration we will use:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"threshold: majority"}),"\n",(0,s.jsx)(o.li,{children:"quorum: 20%"}),"\n",(0,s.jsx)(o.li,{children:"max voting period: 1 week"}),"\n",(0,s.jsx)(o.li,{children:"only members can execute: true"}),"\n",(0,s.jsx)(o.li,{children:"close proposal on execution failure: true"}),"\n",(0,s.jsx)(o.li,{children:"allow revoting: false"}),"\n",(0,s.jsx)(o.li,{children:"submission policy: DAO members only"}),"\n",(0,s.jsx)(o.li,{children:"no proposal deposit"}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["You can look at the JSON schemas' ",(0,s.jsx)(o.code,{children:"instantiate"})," definitions for the proposal and\npre-propose modules to see the configuration fields you need to set, as well as\nthe ",(0,s.jsx)(o.code,{children:"dao-dao-core"})," contract's JSON schema to see the ",(0,s.jsx)(o.code,{children:"update_proposal_modules"}),"\nexecution message that performs the actual update:"]}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:(0,s.jsx)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/proposal/dao-proposal-single/schema/dao-proposal-single.json",children:"dao-proposal-single JSON schema"})}),"\n",(0,s.jsx)(o.li,{children:(0,s.jsx)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/pre-propose/dao-pre-propose-single/schema/dao-pre-propose-single.json",children:"dao-pre-propose-single JSON\nschema"})}),"\n",(0,s.jsx)(o.li,{children:(0,s.jsx)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/dao-dao-core/schema/dao-dao-core.json",children:"dao-dao-core JSON schema"})}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["You can also look at the Rust source code, which contains the corresponding\n",(0,s.jsx)(o.code,{children:"InstantiateMsg"})," and ",(0,s.jsx)(o.code,{children:"ExecuteMsg"})," structs, though you will need to know how\nserde serializes various types and enums which can be tricky. The JSON schemas\nabove contain all the information you need, but here is the source code for\nreference:"]}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:(0,s.jsxs)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/proposal/dao-proposal-single/src/msg.rs",children:["dao-proposal-single ",(0,s.jsx)(o.code,{children:"InstantiateMsg"}),"\nstruct"]})}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsxs)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/pre-propose/dao-pre-propose-single/src/contract.rs",children:["dao-pre-propose-single ",(0,s.jsx)(o.code,{children:"InstantiateMsg"}),"\nstruct"]}),"\nwhich just extends the ",(0,s.jsxs)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/packages/dao-pre-propose-base/src/msg.rs",children:["dao-pre-propose-base ",(0,s.jsx)(o.code,{children:"InstantiateMsg"}),"\nstruct"]})]}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsxs)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/packages/dao-interface/src/msg.rs",children:["dao-dao-core ",(0,s.jsx)(o.code,{children:"ExecuteMsg"}),"\nstruct"]}),"\ndefined in the ",(0,s.jsx)(o.code,{children:"dao-interface"})," crate."]}),"\n"]}),"\n",(0,s.jsx)(o.p,{children:"Putting that all together, the full message we need to execute on the DAO via a\nproposal, with everything decoded for readability, follows:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:'{\n  "update_proposal_modules": {\n    "to_add": [{\n      "admin": { "core_module": {} },\n      "code_id": 1252,\n      "label": "dao-proposal-single-v2.6.0",\n      "msg": {\n        "threshold": {\n          "threshold_quorum": {\n            "threshold": { "majority": {} },\n            "quorum": { "percent": "0.2" }\n          }\n        },\n        "max_voting_period": { "time": 604800 },\n        "only_members_execute": true,\n        "close_proposal_on_execution_failure": true,\n        "allow_revoting": false,\n        "pre_propose_info": {\n          "module_may_propose": {\n            "info": {\n              "code_id": 1250,\n              "msg": {\n                "submission_policy": {\n                  "specific": {\n                    "dao_members": true,\n                    "allowlist": [],\n                    "denylist": []\n                  }\n                },\n                "extension": {}\n              },\n              "admin": { "core_module": {} },\n              "funds": [],\n              "label": "dao-pre-propose-single-v2.6.0"\n            }\n          }\n        }\n      },\n      "funds": []\n    }],\n    "to_disable": []\n  }\n}\n'})}),"\n",(0,s.jsxs)(o.p,{children:["Now we have to recursively encode the ",(0,s.jsx)(o.code,{children:"msg"})," fields with base64, so starting from\nthe innermost ",(0,s.jsx)(o.code,{children:"msg"})," field for the pre-propose module instantiation message:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:'{\n  "submission_policy": {\n    "specific": {\n      "dao_members": true,\n      "allowlist": [],\n      "denylist": []\n    }\n  },\n  "extension": {}\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"This gets base64-encoded to:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:"ewogICJzdWJtaXNzaW9uX3BvbGljeSI6IHsKICAgICJzcGVjaWZpYyI6IHsKICAgICAgImRhb19tZW1iZXJzIjogdHJ1ZSwKICAgICAgImFsbG93bGlzdCI6IFtdLAogICAgICAiZGVueWxpc3QiOiBbXQogICAgfQogIH0sCiAgImV4dGVuc2lvbiI6IHt9Cn0=\n"})}),"\n",(0,s.jsxs)(o.p,{children:["Now isolate the proposal module instantiation ",(0,s.jsx)(o.code,{children:"msg"}),", and replace the pre-propose\nmodule instantiation ",(0,s.jsx)(o.code,{children:"msg"})," field with the base64-encoded pre-propose module\ninstantiation message from above:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:'{\n  "threshold": {\n    "threshold_quorum": {\n      "threshold": { "majority": {} },\n      "quorum": { "percent": "0.2" }\n    }\n  },\n  "max_voting_period": { "time": 604800 },\n  "only_members_execute": true,\n  "close_proposal_on_execution_failure": true,\n  "allow_revoting": false,\n  "pre_propose_info": {\n    "module_may_propose": {\n      "info": {\n        "code_id": 1250,\n        "msg": "ewogICJzdWJtaXNzaW9uX3BvbGljeSI6IHsKICAgICJzcGVjaWZpYyI6IHsKICAgICAgImRhb19tZW1iZXJzIjogdHJ1ZSwKICAgICAgImFsbG93bGlzdCI6IFtdLAogICAgICAiZGVueWxpc3QiOiBbXQogICAgfQogIH0sCiAgImV4dGVuc2lvbiI6IHt9Cn0=",\n        "admin": { "core_module": {} },\n        "funds": [],\n        "label": "dao-pre-propose-single-v2.6.0"\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"This gets base64-encoded to:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:"ewogICJ0aHJlc2hvbGQiOiB7CiAgICAidGhyZXNob2xkX3F1b3J1bSI6IHsKICAgICAgInRocmVzaG9sZCI6IHsgIm1ham9yaXR5Ijoge30gfSwKICAgICAgInF1b3J1bSI6IHsgInBlcmNlbnQiOiAiMC4yIiB9CiAgICB9CiAgfSwKICAibWF4X3ZvdGluZ19wZXJpb2QiOiB7ICJ0aW1lIjogNjA0ODAwIH0sCiAgIm9ubHlfbWVtYmVyc19leGVjdXRlIjogdHJ1ZSwKICAiY2xvc2VfcHJvcG9zYWxfb25fZXhlY3V0aW9uX2ZhaWx1cmUiOiB0cnVlLAogICJhbGxvd19yZXZvdGluZyI6IGZhbHNlLAogICJwcmVfcHJvcG9zZV9pbmZvIjogewogICAgIm1vZHVsZV9tYXlfcHJvcG9zZSI6IHsKICAgICAgImluZm8iOiB7CiAgICAgICAgImNvZGVfaWQiOiAxMjUwLAogICAgICAgICJtc2ciOiAiZXdvZ0lDSnpkV0p0YVhOemFXOXVYM0J2YkdsamVTSTZJSHNLSUNBZ0lDSnpjR1ZqYVdacFl5STZJSHNLSUNBZ0lDQWdJbVJoYjE5dFpXMWlaWEp6SWpvZ2RISjFaU3dLSUNBZ0lDQWdJbUZzYkc5M2JHbHpkQ0k2SUZ0ZExBb2dJQ0FnSUNBaVpHVnVlV3hwYzNRaU9pQmJYUW9nSUNBZ2ZRb2dJSDBzQ2lBZ0ltVjRkR1Z1YzJsdmJpSTZJSHQ5Q24wPSIsCiAgICAgICAgImFkbWluIjogeyAiY29yZV9tb2R1bGUiOiB7fSB9LAogICAgICAgICJmdW5kcyI6IFtdLAogICAgICAgICJsYWJlbCI6ICJkYW8tcHJlLXByb3Bvc2Utc2luZ2xlLXYyLjYuMCIKICAgICAgfQogICAgfQogIH0KfQ==\n"})}),"\n",(0,s.jsxs)(o.p,{children:["Now replace the proposal module instantiation ",(0,s.jsx)(o.code,{children:"msg"})," field in the\n",(0,s.jsx)(o.code,{children:"update_proposal_modules"})," execution message with the base64-encoded proposal\nmodule instantiation message from above:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:'{\n  "update_proposal_modules": {\n    "to_add": [{\n      "admin": { "core_module": {} },\n      "code_id": 1252,\n      "label": "dao-proposal-single-v2.6.0",\n      "msg": "ewogICJ0aHJlc2hvbGQiOiB7CiAgICAidGhyZXNob2xkX3F1b3J1bSI6IHsKICAgICAgInRocmVzaG9sZCI6IHsgIm1ham9yaXR5Ijoge30gfSwKICAgICAgInF1b3J1bSI6IHsgInBlcmNlbnQiOiAiMC4yIiB9CiAgICB9CiAgfSwKICAibWF4X3ZvdGluZ19wZXJpb2QiOiB7ICJ0aW1lIjogNjA0ODAwIH0sCiAgIm9ubHlfbWVtYmVyc19leGVjdXRlIjogdHJ1ZSwKICAiY2xvc2VfcHJvcG9zYWxfb25fZXhlY3V0aW9uX2ZhaWx1cmUiOiB0cnVlLAogICJhbGxvd19yZXZvdGluZyI6IGZhbHNlLAogICJwcmVfcHJvcG9zZV9pbmZvIjogewogICAgIm1vZHVsZV9tYXlfcHJvcG9zZSI6IHsKICAgICAgImluZm8iOiB7CiAgICAgICAgImNvZGVfaWQiOiAxMjUwLAogICAgICAgICJtc2ciOiAiZXdvZ0lDSnpkV0p0YVhOemFXOXVYM0J2YkdsamVTSTZJSHNLSUNBZ0lDSnpjR1ZqYVdacFl5STZJSHNLSUNBZ0lDQWdJbVJoYjE5dFpXMWlaWEp6SWpvZ2RISjFaU3dLSUNBZ0lDQWdJbUZzYkc5M2JHbHpkQ0k2SUZ0ZExBb2dJQ0FnSUNBaVpHVnVlV3hwYzNRaU9pQmJYUW9nSUNBZ2ZRb2dJSDBzQ2lBZ0ltVjRkR1Z1YzJsdmJpSTZJSHQ5Q24wPSIsCiAgICAgICAgImFkbWluIjogeyAiY29yZV9tb2R1bGUiOiB7fSB9LAogICAgICAgICJmdW5kcyI6IFtdLAogICAgICAgICJsYWJlbCI6ICJkYW8tcHJlLXByb3Bvc2Utc2luZ2xlLXYyLjYuMCIKICAgICAgfQogICAgfQogIH0KfQ==",\n      "funds": []\n    }],\n    "to_disable": []\n  }\n}\n'})}),"\n",(0,s.jsxs)(o.p,{children:["And you have the full message to execute on the DAO via a proposal. You can now\nuse the DAO DAO UI to create a proposal with the ",(0,s.jsx)(o.code,{children:"Execute Smart Contract"}),"\naction, with the contract address being the DAO's ",(0,s.jsx)(o.code,{children:"dao-dao-core"})," contract, and\nthe message field containing the above text."]}),"\n",(0,s.jsx)(o.p,{children:"Once you execute this, test the new proposal module by creating a proposal,\nvoting on it, and executing it. If everything seems to work, you can now disable\nthe old single choice proposal module by executing the following message in\nanother proposal:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:'{\n  "update_proposal_modules": {\n    "to_add": [],\n    "to_disable": ["EXISTING PROPOSAL MODULE ADDRESS"]\n  }\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"Ideally, wait a while to see the new proposal module in action before disabling\nthe old one."})]})}function p(e={}){const{wrapper:o}={...(0,l.a)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},1151:(e,o,n)=>{n.d(o,{Z:()=>a,a:()=>i});var s=n(7294);const l={},t=s.createContext(l);function i(e){const o=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(t.Provider,{value:o},e.children)}}}]);