"use strict";(self.webpackChunk_dao_dao_docs=self.webpackChunk_dao_dao_docs||[]).push([[9129],{2600:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>i,contentTitle:()=>t,default:()=>c,frontMatter:()=>a,metadata:()=>d,toc:()=>l});var s=n(5893),r=n(1151);const a={sidebar_position:6},t="How to change a pre-propose module",d={id:"dao-governance/proposals/how-to-change-a-pre-propose-module",title:"How to change a pre-propose module",description:"The proposal module system enables DAOs to support any type of execution flow",source:"@site/docs/dao-governance/proposals/how-to-change-a-pre-propose-module.md",sourceDirName:"dao-governance/proposals",slug:"/dao-governance/proposals/how-to-change-a-pre-propose-module",permalink:"/dao-governance/proposals/how-to-change-a-pre-propose-module",draft:!1,unlisted:!1,editUrl:"https://github.com/DA0-DA0/docs/tree/main/docs/dao-governance/proposals/how-to-change-a-pre-propose-module.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"How to add a proposal module",permalink:"/dao-governance/proposals/how-to-add-a-proposal-module"},next:{title:"Manage Vetoable DAOs",permalink:"/dao-governance/manage-vetoable-daos"}},i={},l=[{value:"Guide",id:"guide",level:2}];function p(e){const o={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.h1,{id:"how-to-change-a-pre-propose-module",children:"How to change a pre-propose module"}),"\n",(0,s.jsx)(o.p,{children:"The proposal module system enables DAOs to support any type of execution flow\nthat can be coded in a smart contract, and the pre-propose module is the first\nstep in the proposal process. It determines the process for submitting a\nproposal: who can propose something, whether or not there's a deposit, etc."}),"\n",(0,s.jsx)(o.p,{children:"Proposal modules can either set a pre-propose module, or not use one, which\neffectively removes all restrictions (meaning anyone can submit a proposal)."}),"\n",(0,s.jsx)(o.p,{children:"There are two pre-propose module types:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"base: manages deposits and submission policy"}),"\n",(0,s.jsx)(o.li,{children:"approval: same as base, plus the ability to set an approver that must\napprove pending proposals before they open for voting on the proposal module"}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["Each proposal module has corresponding pre-propose modules (e.g. the\n",(0,s.jsx)(o.code,{children:"dao-proposal-single"})," module has ",(0,s.jsx)(o.code,{children:"dao-pre-propose-single"})," and\n",(0,s.jsx)(o.code,{children:"dao-pre-propose-approval-single"}),", the ",(0,s.jsx)(o.code,{children:"dao-proposal-multiple"})," module has\n",(0,s.jsx)(o.code,{children:"dao-pre-propose-multiple"})," and ",(0,s.jsx)(o.code,{children:"dao-pre-propose-approval-multiple"}),", etc.)."]}),"\n",(0,s.jsx)(o.p,{children:"You can always add, remove, or replace the pre-propose module for a proposal\nmodule."}),"\n",(0,s.jsx)(o.p,{children:"Adding and disabling proposal modules is not common, and can be dangerous, and\nthus is not easily supported by the UI, but it is not hard to do with a little\nbit of time."}),"\n",(0,s.jsxs)(o.blockquote,{children:["\n",(0,s.jsx)(o.p,{children:"\u26a0\ufe0f Be careful, the DAO will be bricked and all assets will be locked if the\npre-propose module is misconfigured. It is best practice to ensure at least\none is functioning before disabling another. Or, better yet, just add an\nentirely new proposal module and then disable the existing one, instead of\ntrying to change the pre-propose module."}),"\n"]}),"\n",(0,s.jsx)(o.h2,{id:"guide",children:"Guide"}),"\n",(0,s.jsxs)(o.p,{children:["First you need the address of the proposal module and the code ID of the\npre-propose module. You can find all uploaded DAO DAO code IDs here:\n",(0,s.jsx)(o.a,{href:"https://github.com/DA0-DA0/dao-dao-ui/blob/development/packages/utils/constants/codeIds.json",children:"https://github.com/DA0-DA0/dao-dao-ui/blob/development/packages/utils/constants/codeIds.json"})]}),"\n",(0,s.jsxs)(o.p,{children:["The following guide will update a ",(0,s.jsx)(o.code,{children:"v2.6.0"})," single choice proposal module to use\nthe ",(0,s.jsx)(o.code,{children:"v2.6.0"})," base pre-propose module on Osmosis mainnet (",(0,s.jsx)(o.code,{children:"osmosis-1"}),"), so we\nneed the ",(0,s.jsx)(o.code,{children:"dao-proposal-single"})," address and ",(0,s.jsx)(o.code,{children:"dao-pre-propose-single"})," code ID."]}),"\n",(0,s.jsxs)(o.p,{children:["You can use the DAO DAO indexer to query for the active proposal modules in a\nDAO and find the ",(0,s.jsx)(o.code,{children:"dao-proposal-single"})," address:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"DAO_ADDRESS=INSERT_DAO_ADDRESS curl -s https://indexer.daodao.zone/osmosis-1/contract/$DAO_ADDRESS/daoCore/activeProposalModules | jq\n"})}),"\n",(0,s.jsx)(o.p,{children:"Or query the chain directly:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"osmosisd query contract-state smart $DAO_ADDRESS '{\"active_proposal_modules\":{}}' --output json | jq\n"})}),"\n",(0,s.jsx)(o.p,{children:"The output will look like this:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-json",children:'[\n  {\n    "prefix": "A",\n    "status": "enabled",\n    "address": "DAO_PROPOSAL_SINGLE_ADDRESS",\n    "info": { "version": "2.6.0", "contract": "crates.io:dao-proposal-single" }\n  },\n  {\n    "prefix": "B",\n    "status": "enabled",\n    "address": "DAO_PROPOSAL_MULTIPLE_ADDRESS",\n    "info": {\n      "version": "2.6.0",\n      "contract": "crates.io:dao-proposal-multiple"\n    }\n  }\n]\n'})}),"\n",(0,s.jsxs)(o.p,{children:["You can see the ",(0,s.jsx)(o.code,{children:"dao-proposal-single"})," address is ",(0,s.jsx)(o.code,{children:"DAO_PROPOSAL_SINGLE_ADDRESS"}),"."]}),"\n",(0,s.jsxs)(o.p,{children:["You can also find the ",(0,s.jsx)(o.code,{children:"dao-pre-propose-single"})," code ID in the ",(0,s.jsx)(o.code,{children:"codeIds.json"}),"\nfile linked above: ",(0,s.jsx)(o.code,{children:"1250"}),"."]}),"\n",(0,s.jsxs)(o.p,{children:["A few steps involve base64 encoding, which\n",(0,s.jsx)(o.a,{href:"https://www.base64encode.org/",children:"base64encode.org"})," can help with."]}),"\n",(0,s.jsx)(o.p,{children:"Here is the configuration we will use:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"submission policy: DAO members only"}),"\n",(0,s.jsx)(o.li,{children:"no proposal deposit"}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["You can look at the JSON schemas' ",(0,s.jsx)(o.code,{children:"instantiate"})," definitions for the pre-propose\nmodule to see the configuration fields you need to set, as well as the\n",(0,s.jsx)(o.code,{children:"dao-proposal-single"})," contract's JSON schema to see the\n",(0,s.jsx)(o.code,{children:"update_pre_propose_info"})," execution message that performs the actual update:"]}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:(0,s.jsx)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/pre-propose/dao-pre-propose-single/schema/dao-pre-propose-single.json",children:"dao-pre-propose-single JSON schema"})}),"\n",(0,s.jsx)(o.li,{children:(0,s.jsx)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/proposal/dao-proposal-single/schema/dao-proposal-single.json",children:"dao-proposal-single JSON schema"})}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["You can also look at the Rust source code, which contains the corresponding\n",(0,s.jsx)(o.code,{children:"InstantiateMsg"})," and ",(0,s.jsx)(o.code,{children:"ExecuteMsg"})," structs, though you will need to know how\nserde serializes various types and enums which can be tricky. The JSON schemas\nabove contain all the information you need, but here is the source code for\nreference:"]}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:(0,s.jsxs)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/proposal/dao-proposal-single/src/msg.rs",children:["dao-proposal-single ",(0,s.jsx)(o.code,{children:"ExecuteMsg"}),"\nstruct"]})}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsxs)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/contracts/pre-propose/dao-pre-propose-single/src/contract.rs",children:["dao-pre-propose-single ",(0,s.jsx)(o.code,{children:"InstantiateMsg"}),"\nstruct"]}),"\nwhich just extends the ",(0,s.jsxs)(o.a,{href:"https://github.com/DA0-DA0/dao-contracts/blob/development/packages/dao-pre-propose-base/src/msg.rs",children:["dao-pre-propose-base ",(0,s.jsx)(o.code,{children:"InstantiateMsg"}),"\nstruct"]})]}),"\n"]}),"\n",(0,s.jsx)(o.p,{children:"Putting that all together, the full message we need to execute on the proposal\nmodule via a proposal, with everything decoded for readability, follows:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:'{\n  "update_pre_propose_info": {\n    "info": {\n      "module_may_propose": {\n        "info": {\n          "code_id": 1250,\n          "msg": {\n            "submission_policy": {\n              "specific": {\n                "dao_members": true,\n                "allowlist": [],\n                "denylist": []\n              }\n            },\n            "extension": {}\n          },\n          "admin": { "core_module": {} },\n          "funds": [],\n          "label": "dao-pre-propose-single-v2.6.0"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(o.p,{children:["Now we have to encode the ",(0,s.jsx)(o.code,{children:"msg"})," field with base64:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:'{\n  "submission_policy": {\n    "specific": {\n      "dao_members": true,\n      "allowlist": [],\n      "denylist": []\n    }\n  },\n  "extension": {}\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"This gets base64-encoded to:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:"ewogICJzdWJtaXNzaW9uX3BvbGljeSI6IHsKICAgICJzcGVjaWZpYyI6IHsKICAgICAgImRhb19tZW1iZXJzIjogdHJ1ZSwKICAgICAgImFsbG93bGlzdCI6IFtdLAogICAgICAiZGVueWxpc3QiOiBbXQogICAgfQogIH0sCiAgImV4dGVuc2lvbiI6IHt9Cn0=\n"})}),"\n",(0,s.jsxs)(o.p,{children:["Now replace the pre-propose module instantiation ",(0,s.jsx)(o.code,{children:"msg"})," field with the\nbase64-encoded instantiation message:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{children:'{\n  "update_pre_propose_info": {\n    "info": {\n      "module_may_propose": {\n        "info": {\n          "code_id": 1250,\n          "msg": "ewogICJzdWJtaXNzaW9uX3BvbGljeSI6IHsKICAgICJzcGVjaWZpYyI6IHsKICAgICAgImRhb19tZW1iZXJzIjogdHJ1ZSwKICAgICAgImFsbG93bGlzdCI6IFtdLAogICAgICAiZGVueWxpc3QiOiBbXQogICAgfQogIH0sCiAgImV4dGVuc2lvbiI6IHt9Cn0=",\n          "admin": { "core_module": {} },\n          "funds": [],\n          "label": "dao-pre-propose-single-v2.6.0"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(o.p,{children:["And you have the full message to execute on the proposal module via a proposal.\nYou can now use the DAO DAO UI to create a proposal with the ",(0,s.jsx)(o.code,{children:"Execute Smart Contract"})," action, with the contract address being the ",(0,s.jsx)(o.code,{children:"dao-proposal-single"}),"\nmodule's address, and the message field containing the above text. Once you pass\nand execute the proposal, the pre-propose module will be updated."]})]})}function c(e={}){const{wrapper:o}={...(0,r.a)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},1151:(e,o,n)=>{n.d(o,{Z:()=>d,a:()=>t});var s=n(7294);const r={},a=s.createContext(r);function t(e){const o=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(a.Provider,{value:o},e.children)}}}]);